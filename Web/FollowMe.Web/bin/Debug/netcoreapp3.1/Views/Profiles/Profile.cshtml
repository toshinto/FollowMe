@using  System.Text;
@using Microsoft.AspNetCore.Identity
@using FollowMe.Data.Models
@using System.Globalization;
@model FollowMe.Web.ViewModels.Profiles.ProfileViewPersonalDetailsViewModel
@inject UserManager<ApplicationUser> user
@{
    var userId = this.user.GetUserId(this.User);
}

<div class="container bootstrap snippets bootdey">
    <div class="row ng-scope">
        <div class="col-md-4">
            <div class="panel panel-default">
                <div class="panel-body text-center">
                    <div class="pv-lg"><img src="@Model.CoverImageUrl" style="height:430px; width:450px"></div>
                    <h3 class="m0 text-bold"></h3>
                    <div class="mv-lg">
                        <p>@Model.FullName</p>
                        <p>@Model.Description</p>
                    </div>
                    <div class="text-center"><a class="btn btn-primary" href="">Send message</a></div>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="h4 text-center">Personal information</div>
                    <div class="row pv-lg">
                        <div class="col-lg-2"></div>
                        <div class="col-lg-8">
                            <form class="form-horizontal ng-pristine ng-valid">
                                <div class="form-group">
                                    <label class="control-label" for="inputContact1">Birthday: @Model.BirthDate.ToString("dd-MM-yyyy", CultureInfo.CreateSpecificCulture("en-US"))</label>
                                    <hr />
                                    <label class="control-label" for="inputContact1">Height: @Model.Height </label>
                                    <hr />
                                    <label class="control-label" for="inputContact1">Age: @Model.Age </label>
                                    <hr />
                                    <label class="control-label" for="inputContact1">Weight: @Model.Weight </label>
                                    <hr />
                                    <label class="control-label" for="inputContact1">Gender: @Model.Gender</label>
                                    <hr />
                                    <label class="control-label" for="inputContact1">City: @Model.City </label>
                                    <hr />
                                    <label class="control-label" for="inputContact1">Eyes color: @Model.EyeColor</label>
                                    <hr />
                                    <label class="control-label" for="inputContact1">Hair color: @Model.HairColor</label>
                                    <hr />
                                    <label class="control-label" for="inputContact1">Status: @Model.WeddingStatus</label>
                                    <hr />
                                    <label class="control-label" for="inputContact1">What are you searching for: @Model.WhatAreYouSearchingFor</label>
                                </div>

                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
<hr />
<div class="row justify-content-center">
    <a href="/Posts/Create?id=@Model.UserId" class="btn btn-primary btn-lg text-center">Create new post</a>
</div>
<hr />
@foreach (var post in Model.UserPosts)
{
    <div class="container">
        <div class="well">
            <div class="media">
                <a class="pull-left" href="/Profiles/Profile?id=@post.SentById">
                    <img class="media-object" style="height:140px; width:140px;" src="@post.SentByUserCharacteristicsCoverImageUrl">
                </a>
                <div class="media-body">
                    <div class="text-muted small ml-3">
                        <form id="votesForm" asp-controller="Votes" asp-action="Post" method="post"></form>
                        <div>
                            <a href="#" onclick="sendVote(@post.Id, true)">
                                <i class="fa fa-thumbs-up"></i>
                            </a>
                        </div>
                        <div id="votesCount">@post.VotesCount</div>
                        <div>
                            <a href="#" onclick="sendVote(@post.Id, false)">
                                <i class="fa fa-thumbs-down"></i>
                            </a>
                        </div>
                    </div>
                    <p class="text-right"><i class="fas fa-user"></i>By @post.SentByUserCharacteristicsFullName</p>
                    <p>
                        @post.Content
                    </p>
                    <ul class="list-inline list-unstyled">
                        <li><span><i class="fas fa-calendar-alt"></i>@post.CreatedOn.ToString("MM/dd/yy H:mm:ss", CultureInfo.CreateSpecificCulture("en-US"))</span></li>
                        <li>
                            <span><i class="fas fa-comment"></i>Comments: @post.CommentsCount</span>
                        </li>
                    </ul>
                    @foreach (var comment in post.Comments.OrderByDescending(x => x.CreatedOn))
                    {
                        <div class="comment" id="comment">
                            <a class="pull-left" href="/Profiles/Profile?id=@comment.UserId">
                                <img class="media-object" style="height:50px; width:50px;" src="@comment.UserUserCharacteristicsCoverImageUrl" />
                            </a>
                            <p>
                                @comment.Content
                            </p>
                            <p class="text-right">
                                <i class="fas fa-user"></i>By @comment.UserUserCharacteristicsFullName
                            </p>
                            <p>
                                @comment.CreatedOn.ToString("MM/dd/yy H:mm:ss", CultureInfo.CreateSpecificCulture("en-US"))
                            </p>
                        </div>
                        <hr />
                    }
                </div>
            </div>
        </div>

        <div class="row justify-content-md-end">
            <a href="/Comments/Create?id=@post.Id&userId=@userId" style="margin-right:14px" class="btn btn-primary btn-lg text-center">Add comment</a>
        </div>
    </div>
    <hr />
}
@section Scripts {
    <script>
         function sendVote(postId, isUpVote) {
            var token = $("#votesForm input[name=__RequestVerificationToken]").val();
            var json = { postId: postId, isUpVote: isUpVote };
            $.ajax({
                url: "/api/votes",
                type: "POST",
                data: JSON.stringify(json),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                headers: { 'X-CSRF-TOKEN': token },
                success: function (data) {
                    $("#votesCount").html(data.votesCount);
                }
            });
        }
    </script>
}

